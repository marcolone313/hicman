<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">

<!-- Header Fragment -->

<head th:replace="~{fragments/header :: header}"></head>


<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NBR825RZ" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <!-- Navbar Fragment -->
    <nav th:replace="~{fragments/navbar :: navbar('home')}"></nav>

    <main>
        <!-- Hero Section -->
        <section class="hero-section">
            <!-- Video Background Section -->
            <div class="video-background desktop-video">
                <video autoplay muted loop playsinline preload="metadata">
                    <source th:src="@{/video/video-desktop.mp4}" type="video/mp4">
                </video>
            </div>

            <div class="video-background tablet-video">
                <video autoplay muted loop playsinline preload="metadata">
                    <source th:src="@{/video/video-desktop.mp4}" type="video/mp4">
                </video>
            </div>

            <div class="video-background tablet-vertical-video">
                <video autoplay muted loop playsinline preload="metadata">
                    <source src="https://oscvideo.s3.eu-central-1.amazonaws.com/FoldablesAndVerticalTablet.mp4"
                        type="video/mp4">
                </video>
            </div>

            <div class="video-background mobile-video">
                <video autoplay muted loop playsinline preload="metadata">
                    <source th:src="@{/video/video-mobile.mp4}" type="video/mp4">
                </video>
            </div>
            <div class="hero-overlay"></div>

            <div class="hero-content">
                <h1 class="animate__animated animate__fadeInUp"
                    th:utext="${#strings.replace(#messages.msg('home.hero.title'), '&#10;', '<br/>')}">Progetta e
                    realizza eventi <br>e applicativi software</h1>
                <p class="animate__animated animate__fadeInUp animate__delay-1s"
                    th:utext="${#strings.replace(#messages.msg('home.hero.subtitle'), '&#10;', '<br/>')}">
                    Soluzioni custom con nuove tecnologie, strategia e creatività</p>
                <div class="hero-buttons animate__animated animate__fadeInUp animate__delay-2s">
                    <a href="#services-cards" class="btn-custom_scopri btn-primary-custom"
                        th:text="#{home.hero.button.discover}">Scopri di più</a>
                </div>
            </div>

            <!-- Showreel button -->
            <div class="showreel-button animate__animated animate__fadeInUp animate__delay-3s">
                <a class="btn-custom btn-outline-custom-white" href="https://www.youtube.com/watch?v=7gowzF_AwXs"
                    target="_blank" rel="noopener noreferrer">
                    <i class="bi bi-play-circle me-2"></i>
                    <span th:text="#{home.hero.button.showreel}">Showreel</span>
                </a>
            </div>
        </section>

        <div class="line-divisoria"></div>

        <!-- Business Units Section -->
        <section id="services-cards" class="container-fluid py-5">
            <div class="container-xxl px-4">
                <h2 class="section-title" th:text="#{home.businessUnits.title}">BUSINESS UNITS</h2>

                <div class="row g-4 justify-content-center">
                    <!-- Eventi Card -->
                    <div class="col-12 col-sm-6 col-lg-3 min-card-width">
                        <div class="card card-custom eventi h-100">
                            <div class="card-img-wrapper">
                                <img th:src="@{/images/Eventi.png}" class="card-img-top" alt="Eventi" loading="lazy">
                            </div>
                            <div class="card-body">
                                <div class="card-text-container">
                                    <p class="card-text" th:text="#{home.eventi.service1}">Projection Mapping</p>
                                    <p class="card-text" th:text="#{home.eventi.service2}">Installazioni Immersive e
                                        Interattive</p>
                                    <p class="card-text" th:text="#{home.eventi.service3}">Robot e Droni per Live Show
                                    </p>
                                    <p class="card-text" th:text="#{home.eventi.service4}">Service Audio - Video - Luci
                                    </p>
                                    <p class="card-text" th:text="#{home.eventi.service5}">Progettazione Tecnologica</p>
                                </div>
                                <div class="card-button">
                                    <a href="https://eventi.oscinnovation.com" target="_blank" rel="noopener noreferrer"
                                        class="btn-custom btn-outline-custom"
                                        th:text="#{home.businessCase.button.more}">Scopri di più</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Virtuale Card -->
                    <div class="col-12 col-sm-6 col-lg-3 min-card-width">
                        <div class="card card-custom virtuale h-100">
                            <div class="card-img-wrapper">
                                <img th:src="@{/images/Virtuale.png}" class="card-img-top" alt="Virtuale"
                                    loading="lazy">
                            </div>
                            <div class="card-body">
                                <div class="card-text-container">
                                    <p class="card-text" th:text="#{home.virtuale.service1}">Realtà Aumentata Live</p>
                                    <p class="card-text" th:text="#{home.virtuale.service2}">Realtà Virtuale, Visori e
                                        Metaverso</p>
                                    <p class="card-text" th:text="#{home.virtuale.service3}">Virtual Mirror</p>
                                    <p class="card-text" th:text="#{home.virtuale.service4}">App in AR e VR</p>
                                    <p class="card-text" th:text="#{home.virtuale.service5}">Social XR - Web AR e VR</p>
                                </div>
                                <div class="card-button">
                                    <a href="https://virtuale.oscinnovation.com" target="_blank"
                                        rel="noopener noreferrer" class="btn-custom btn-outline-custom"
                                        th:text="#{home.businessCase.button.more}">Scopri di più</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Digitale Card -->
                    <div class="col-12 col-sm-6 col-lg-3 min-card-width">
                        <div class="card card-custom digitale h-100">
                            <div class="card-img-wrapper">
                                <img th:src="@{/images/Digitale.png}" class="card-img-top" alt="Digitale"
                                    loading="lazy">
                            </div>
                            <div class="card-body">
                                <div class="card-text-container">
                                    <p class="card-text" th:text="#{home.digitale.service1}">Software Personalizzati</p>
                                    <p class="card-text" th:text="#{home.digitale.service2}">Intelligenza Artificiale
                                    </p>
                                    <p class="card-text" th:text="#{home.digitale.service3}">Applicazioni Mobile</p>
                                    <p class="card-text" th:text="#{home.digitale.service4}">Digital Signage</p>
                                    <p class="card-text" th:text="#{home.digitale.service5}">Web Marketing e Social</p>
                                    <p class="card-text" th:text="#{home.digitale.service6}">Contenuti 3D e Multimediali
                                    </p>
                                </div>
                                <div class="card-button">
                                    <a href="https://digitale.oscinnovation.com" target="_blank"
                                        rel="noopener noreferrer" class="btn-custom btn-outline-custom"
                                        th:text="#{home.businessCase.button.more}">Scopri di più</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hype Card -->
                    <div class="col-12 col-sm-6 col-lg-3 min-card-width">
                        <div class="card card-custom hype h-100">
                            <div class="card-img-wrapper">
                                <img th:src="@{/images/Hype.png}" class="card-img-top" alt="Hype" loading="lazy">
                            </div>
                            <div class="card-body">
                                <div class="card-text-container">
                                    <p class="card-text" th:text="#{home.hype.service1}">Innovazione Strategica</p>
                                    <p class="card-text" th:text="#{home.hype.service2}">Trasferimento Nuove Tecnologie
                                    </p>
                                    <p class="card-text" th:text="#{home.hype.service3}">Coaching e Formazione</p>
                                </div>
                                <div class="card-button">
                                    <span class="btn-custom btn-outline-custom" th:text="#{home.hype.comingSoon}">Coming
                                        Soon</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Business Case Section con immagini cliccabili -->
        <section id="business-case" class="container-fluid py-4">
            <div class="container-xxl px-4">
                <h2 class="section-title" th:text="#{home.businessCase.title}">BUSINESS CASE IN EVIDENZA</h2>

                <div class="bcase-grid">
                    <!-- Banca d'Italia Card -->
                    <!--<div class="bcase-grid-item">
                        <div class="bcase-card bcase-card-eventi">
                            <div class="bcase-img-wrapper">
                                <a href="https://eventi.oscinnovation.com/cases/banca_ditalia" target="_blank"
                                    rel="noopener noreferrer">
                                    <img th:src="@{/images/avventuraMoneta.png}" class="bcase-img" alt="Banca d'Italia"
                                        loading="lazy">
                                </a>
                            </div>
                            <div class="bcase-content">
                                <div class="bcase-text-container">
                                    <p class="bcase-text bcase-text-bold" th:text="#{home.businessCase.bankItaly}">Banca
                                        d'Italia</p>
                                    <p class="bcase-text bcase-subtitle"
                                        th:text="#{home.businessCase.bankItaly.subtitle}">"L'Avventura della Moneta"</p>
                                </div>
                                <div class="bcase-button-wrapper">
                                    <a href="https://eventi.oscinnovation.com/cases/banca_ditalia" target="_blank"
                                        rel="noopener noreferrer" class="bcase-button bcase-button-eventi"
                                        th:text="#{home.businessCase.button.more}">Scopri di più</a>
                                </div>
                            </div>
                        </div>
                    </div>-->
                    <div class="bcase-grid-item">
                        <!-- Massenzio Card -->
                        <div class="bcase-card bcase-card-eventi">
                            <div class="bcase-img-wrapper">
                                <a th:href="@{/massenzio}">
                                    <img th:src="@{/images/massenzio.jpg}" class="bcase-img" alt="Massenzio"
                                        loading="lazy">
                                </a>
                            </div>
                            <div class="bcase-content">
                                <div class="bcase-text-container">
                                    <p class="bcase-text bcase-text-bold" th:text="#{home.businessCase.massenzio}">
                                        massenzio</p>
                                    <p class="bcase-text bcase-subtitle"
                                        th:text="#{home.businessCase.massenzio.subtitle}">"Basilica di Massenzio"</p>
                                </div>
                                <div class="bcase-button-wrapper">
                                    <a th:href="@{/massenzio}" class="bcase-button bcase-button-eventi"
                                        th:text="#{home.businessCase.button.more}">Scopri di più</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bcase-grid-item">
                        <!-- Playstation Card -->
                        <div class="bcase-card bcase-card-virtuale">
                            <div class="bcase-img-wrapper">
                                <a th:href="@{/playstation}">
                                    <img th:src="@{/images/Playstation.png}" class="bcase-img" alt="playstation"
                                        loading="lazy">
                                </a>
                            </div>
                            <div class="bcase-content">
                                <div class="bcase-text-container">
                                    <p class="bcase-text bcase-text-bold" th:text="#{home.businessCase.playstation}">
                                        playstation</p>
                                    <p class="bcase-text bcase-subtitle"
                                        th:text="#{home.businessCase.playstation.subtitle}">"Match The Shapes"</p>
                                </div>
                                <div class="bcase-button-wrapper">
                                    <a th:href="@{/playstation}" class="bcase-button bcase-button-virtuale"
                                        th:text="#{home.businessCase.button.more}">Scopri di più</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Contact Section with Form -->
        <section id="contact" class="container-fluid py-5">
            <div class="container-xxl px-4">
                <h2 class="section-title text-center mb-5" th:text="#{home.contact.title}">Vuoi maggiori informazioni?</h2>
        
                <div class="row g-4">
                    <!-- Form Column -->
                    <div class="col-lg-7 animate__animated animate__fadeInLeft">
                        <div class="card card-custom eventi h-100">
                            <div class="card-body p-4">
                                <h3 class="h4 text-center text-white mb-4" th:text="#{contact.form.title}">Scrivici un messaggio
                                </h3>
        
                                <!-- Alert Messages -->
                                <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show mb-4"
                                    role="alert">
                                    <span id="contact-success" th:text="${successMessage}"></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
        
                                <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show mb-4"
                                    role="alert">
                                    <span th:text="${errorMessage}"></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
        
                                <!-- Contact Form -->
                                <form th:action="@{/}" th:object="${contact}" method="POST">
                                    <div class="row g-3">
                                        <!-- Nome -->
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="text" class="form-control bg-transparent text-white"
                                                    th:field="*{nome}" id="nome" placeholder="" required>
                                                <label for="nome" th:text="#{contact.form.name}">Nome</label>
                                            </div>
                                        </div>
        
                                        <!-- Cognome -->
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="text" class="form-control bg-transparent text-white"
                                                    th:field="*{cognome}" id="cognome" placeholder="" required>
                                                <label for="cognome" th:text="#{contact.form.surname}">Cognome</label>
                                            </div>
                                        </div>
        
                                        <!-- Email -->
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="email" class="form-control bg-transparent text-white"
                                                    th:field="*{email}" id="email" placeholder="" required>
                                                <label for="email" th:text="#{contact.form.email}">Email</label>
                                            </div>
                                        </div>
        
                                        <!-- Telefono -->
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="tel" class="form-control bg-transparent text-white"
                                                    th:field="*{telefono}" id="telefono" placeholder="" pattern="[0-9]+"
                                                    oninput="this.value = this.value.replace(/[^0-9]/g, '')" minlength="6"
                                                    maxlength="15">
                                                <label for="telefono" th:text="#{contact.form.phone}">Telefono
                                                    (opzionale)</label>
                                            </div>
                                        </div>
        
                                        <!-- Messaggio -->
                                        <div class="col-12">
                                            <div class="form-floating">
                                                <textarea class="form-control bg-transparent text-white" th:field="*{messaggio}"
                                                    id="messaggio" placeholder="" style="height: 120px" required
                                                    minlength="10"></textarea>
                                                <label for="messaggio" th:text="#{contact.form.message}">Messaggio</label>
                                            </div>
                                        </div>
        
                                        <!-- Honeypot field -->
                                        <div class="hpt-f">
                                            <input type="text" name="website" id="website" tabindex="-1" autocomplete="off" />
                                        </div>
        
                                        <!-- Submit Button -->
                                        <div class="col-12 text-center">
                                            <button type="submit" class="btn-custom btn-outline-custom">
                                                <i class="bi bi-send me-2"></i><span th:text="#{contact.form.button}">Invia
                                                    Messaggio</span>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
        
                    <!-- Contact Info Column -->
                    <div class="col-lg-5 animate__animated animate__fadeInRight">
                        <div class="card card-custom virtuale h-100">
                            <div class="card-body p-0">
                                <h3 class="h4 text-center text-white mb-4 pt-4" th:text="#{contact.info.title}">Informazioni
                                </h3>
        
                                <!--Whatsapp-->
                                <div class="contact-info-container">
                                    <div class="contact-info-item">
                                        <div class="icon-box-whatsapp">
                                            <a href="https://wa.me/+390687809358" class="social-link" target="_blank"
                                                rel="noopener noreferrer" aria-label="Whatsapp">
                                                <i class="bi bi-whatsapp fs-4"></i>
                                            </a>
                                        </div>
                                        <div class="contact-info-text-wha">
                                            <h5 class="text-white" th:text="#{contact.info.whatsapp}">WhatsApp</h5>
                                        </div>
                                    </div>
        
                                    <!-- Phone -->
                                    <div class="contact-info-item">
                                        <div class="icon-box">
                                            <a href="tel:+390687809358" class="social-link" aria-label="Telefono">
                                                <i class="bi bi-telephone fs-3"></i>
                                            </a>
                                        </div>
                                        <div class="contact-info-text">
                                            <h5 class="text-white" th:text="#{contact.info.phone}">Telefono</h5>
                                            <p class="card-text text-white contact-main-text">+39 06 87809358</p>
                                        </div>
                                    </div>
        
                                    <!-- Email -->
                                    <div class="contact-info-item">
                                        <div class="icon-box">
                                            <a href="mailto:info@oscinnovation.com" class="social-link" aria-label="Email">
                                                <i class="bi bi-envelope fs-3"></i>
                                            </a>
                                        </div>
                                        <div class="contact-info-text">
                                            <h5 class="text-white" th:text="#{contact.info.email}">Email</h5>
                                            <p class="card-text text-white contact-main-text">info@oscinnovation.com</p>
                                        </div>
                                    </div>
        
                                    <!-- Location -->
                                    <div class="contact-info-item">
                                        <div class="icon-box">
                                            <a href="https://www.google.com/maps/search/?api=1&query=Via+Vertumno+2c+Roma,+Italy"
                                                class="social-link" target="_blank" rel="noopener noreferrer"
                                                aria-label="Visualizza sedi su Maps">
                                                <i class="bi bi-geo-alt fs-3"></i>
                                            </a>
                                        </div>
                                        <div class="contact-info-text">
                                            <h5 class="text-white" th:text="#{contact.info.locations}">Sedi</h5>
                                            <p class="card-text text-white contact-main-text"
                                                th:utext="${#strings.replace(#messages.msg('contact.info.address1'), '&#10;', '<br/>')}">
                                                Via Vertumno, 2c</p>
                                            <p class="card-text text-white contact-main-text"
                                                th:utext="${#strings.replace(#messages.msg('contact.info.address2'), '&#10;', '<br/>')}">
                                                Via Prenestina Nuova 307/a</p>
                                            <p class="card-text text-white contact-main-text"
                                                th:utext="${#strings.replace(#messages.msg('contact.info.address3'), '&#10;', '<br/>')}">
                                                Galatro</p>
                                        </div>
                                    </div>
        
                                    <!-- Social Media -->
                                    <div class="social-section">
                                        <h5 class="text-white mb-3" th:text="#{contact.info.social}">Seguici sui Social</h5>
                                        <div class="social-links">
                                            <a href="https://www.linkedin.com/company/oscinnovation/" class="social-link"
                                                target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                                                <i class="bi bi-linkedin fs-4"></i>
                                            </a>
                                            <a href="https://x.com/InnovationOsc?t=tBAVu89e-pK7ldNy2Y87_A&s=08"
                                                class="social-link" target="_blank" rel="noopener noreferrer"
                                                aria-label="Twitter">
                                                <i class="bi bi-twitter-x fs-4"></i>
                                            </a>
                                            <a href="https://www.facebook.com/OSCInnovation" class="social-link" target="_blank"
                                                rel="noopener noreferrer" aria-label="Facebook">
                                                <i class="bi bi-facebook fs-4"></i>
                                            </a>
                                            <a href="https://www.instagram.com/oscinnovation?igsh=MWZ4NTV6dnJzdXZ5ZA=="
                                                class="social-link" target="_blank" rel="noopener noreferrer"
                                                aria-label="Instagram">
                                                <i class="bi bi-instagram fs-4"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- GTM Script con controllo avanzato -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const contactForm = document.querySelector('form[th\\:action="@{/}"]');

                if (contactForm) {
                    // Tracking per form submission
                    contactForm.addEventListener('submit', function (e) {
                        // Validazione client-side GTM
                        const nome = document.getElementById('nome').value;
                        const email = document.getElementById('email').value;
                        const messaggio = document.getElementById('messaggio').value;

                        if (nome && email && messaggio) {
                            window.dataLayer = window.dataLayer || [];
                            window.dataLayer.push({
                                'event': 'contactFormSubmit',
                                'formLocation': window.location.pathname.includes('contact') ? 'contact_page' : 'homepage',
                                'formData': {
                                    'hasName': !!nome,
                                    'hasEmail': !!email,
                                    'hasMessage': !!messaggio,
                                    'messageLength': messaggio.length
                                }
                            });
                        }
                    });
                }

                // Tracking per successo
                const successMessage = document.getElementById('contact-success');
                if (successMessage) {
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event': 'contactFormSuccess',
                        'formLocation': window.location.pathname.includes('contact') ? 'contact_page' : 'homepage'
                    });
                }

                // Tracking per errori di validazione
                const errorMessage = document.querySelector('.alert-danger');
                if (errorMessage) {
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event': 'contactFormError',
                        'formLocation': window.location.pathname.includes('contact') ? 'contact_page' : 'homepage'
                    });
                }
            });
        </script>
    </main>

    <!-- Footer Fragment -->
    <footer th:replace="~{fragments/footer :: footer}"></footer>

    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let lastWindowHeight = window.innerHeight;
            let isResizing = false;

            // Device Detection
            function isIOS() {
                return [
                    'iPad Simulator',
                    'iPhone Simulator',
                    'iPod Simulator',
                    'iPad',
                    'iPhone',
                    'iPod'
                ].includes(navigator.platform)
                    || (navigator.userAgent.includes("Mac") && "ontouchend" in document)
                    || (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream);
            }

            function isAndroid() {
                return /Android/i.test(navigator.userAgent);
            }

            // Nuova funzione per rilevare dispositivi Surface
            function isSurfaceDevice() {
                return /Windows NT/.test(navigator.userAgent) &&
                    (window.innerWidth >= 1000 && window.innerWidth <= 1400) &&
                    (window.innerHeight <= 1080);
            }

            function calculateVideoHeight(video, windowWidth) {
                if (!video.videoHeight || !video.videoWidth) return windowWidth * 1.5; // fallback ratio
                const videoRatio = video.videoHeight / video.videoWidth;
                return windowWidth * videoRatio;
            }

            // Nuova funzione per gestire il layout specifico per Surface
            function adjustSurfaceLayout(heroSection, videoBackground, activeVideo, showreelButton) {
                const viewportHeight = window.innerHeight;
                const navbarHeight = 60;
                const contentMargin = Math.max(viewportHeight * 0.065, 40); // Minimo 40px
                const heroContent = document.querySelector('.hero-content');

                heroSection.style.height = `${viewportHeight}px`;
                heroSection.style.minHeight = '600px';

                if (heroContent) {
                    heroContent.style.marginTop = `${contentMargin}px`;
                    heroContent.style.paddingTop = `${navbarHeight + 8}px`;
                }

                if (showreelButton) {
                    const bottomMargin = Math.max(viewportHeight * 0.047, 30); // Minimo 30px
                    showreelButton.style.bottom = `${bottomMargin}px`;
                    showreelButton.style.left = '17px';
                }

                if (activeVideo && videoBackground) {
                    videoBackground.style.height = '100%';
                    activeVideo.style.objectFit = 'cover';
                    activeVideo.style.width = '100%';
                    activeVideo.style.height = '100%';
                }
            }

            function setHeroHeight() {
                if (isIOS() && Math.abs(lastWindowHeight - window.innerHeight) < 100) {
                    return; // Ignora piccoli cambiamenti di altezza su iOS durante lo scroll
                }

                isResizing = true;
                const activeVideo = Array.from(document.querySelectorAll('.video-background')).find(
                    div => window.getComputedStyle(div).display === 'block'
                )?.querySelector('video');

                if (!activeVideo) return;

                const heroSection = document.querySelector('.hero-section');
                const videoBackground = activeVideo.closest('.video-background');
                const windowWidth = window.innerWidth;
                const isMobile = windowWidth <= 539;
                const showreelButton = document.querySelector('.showreel-button');

                let finalHeight;

                // Gestione specifica per Surface
                if (isSurfaceDevice()) {
                    adjustSurfaceLayout(heroSection, videoBackground, activeVideo, showreelButton);
                } else if (windowWidth >= 1401) {
                    finalHeight = window.innerHeight;
                    heroSection.style.height = '100vh';
                    videoBackground.style.height = '100%';
                    activeVideo.style.objectFit = 'cover';
                } else {
                    const calculatedHeight = calculateVideoHeight(activeVideo, windowWidth);

                    if (isMobile) {
                        if (isIOS()) {
                            finalHeight = Math.max(calculatedHeight, lastWindowHeight);
                            activeVideo.style.objectFit = 'cover';
                            document.documentElement.style.setProperty('--vh', `${lastWindowHeight * 0.01}px`);
                        } else if (isAndroid()) {
                            finalHeight = calculatedHeight * 1.03;
                            activeVideo.style.objectFit = 'contain';
                            activeVideo.style.width = '104%';
                            activeVideo.style.marginLeft = '-2%';
                        } else {
                            finalHeight = calculatedHeight * 1.02;
                        }
                    } else {
                        finalHeight = calculatedHeight;
                    }

                    heroSection.style.height = `${finalHeight}px`;
                    videoBackground.style.height = '100%';
                }

                // Aggiusta la posizione del bottone showreel
                if (showreelButton && !isSurfaceDevice()) {
                    if (isMobile) {
                        if (isIOS()) {
                            showreelButton.style.bottom = '8%';
                        } else if (isAndroid()) {
                            showreelButton.style.bottom = '1.7%';
                        } else {
                            showreelButton.style.bottom = '4%';
                        }
                    } else {
                        showreelButton.style.bottom = '20px';
                    }
                    showreelButton.style.top = 'auto';
                }

                lastWindowHeight = window.innerHeight;
                isResizing = false;
            }

            // Gestione dello scroll per iOS
            let scrollTimeout;
            window.addEventListener('scroll', () => {
                if (isIOS() && !isResizing) {
                    clearTimeout(scrollTimeout);
                    const heroSection = document.querySelector('.hero-section');
                    if (heroSection) {
                        heroSection.style.height = `${lastWindowHeight}px`;
                    }
                }
            }, { passive: true });

            // Gestione degli eventi video con controllo di sicurezza
            function setupVideoListeners(video) {
                const events = ['loadedmetadata', 'loadeddata', 'play', 'canplay', 'canplaythrough'];

                function handleVideoEvent() {
                    if (document.body.contains(video)) {
                        setHeroHeight();
                    }
                }

                events.forEach(event => {
                    video.addEventListener(event, handleVideoEvent);
                });
            }

            document.querySelectorAll('.video-background video').forEach(setupVideoListeners);

            // Primo caricamento con retry
            let retryCount = 0;
            function initialSetup() {
                setHeroHeight();
                const activeVideo = document.querySelector('.video-background video');
                if ((!activeVideo?.videoHeight || !activeVideo?.videoWidth) && retryCount < 5) {
                    retryCount++;
                    setTimeout(initialSetup, 200);
                }
            }
            setTimeout(initialSetup, 100);

            // Gestione del resize con debounce migliorato
            let resizeTimeout;
            window.addEventListener('resize', () => {
                if (!isIOS() || Math.abs(lastWindowHeight - window.innerHeight) >= 100) {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(setHeroHeight, 150);
                }
            });

            // Gestione del cambio di orientamento
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    lastWindowHeight = window.innerHeight;
                    setHeroHeight();
                }, 300);
            });

            // Mobile Menu
            const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('.navbar-collapse');

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (navbarCollapse.classList.contains('show')) {
                        navbarToggler.click();
                    }
                });
            });

            // Script per il form di contatto
            const phoneInput = document.getElementById('telefono');

            if (phoneInput) {
                phoneInput.addEventListener('keypress', function (e) {
                    // Permette solo l'input di numeri
                    if (e.key < '0' || e.key > '9') {
                        e.preventDefault();
                    }
                });

                phoneInput.addEventListener('paste', function (e) {
                    // Previene il paste di testo non numerico
                    e.preventDefault();
                    const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                    if (/^\d+$/.test(pastedText)) {
                        this.value = pastedText;
                    }
                });
            }
        });
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17084339872">
    </script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'AW-17084339872');
    </script>
    <script th:if="${successMessage}">
        gtag('event', 'conversion', {
            'send_to': 'AW-17084339872/ubcDCJ3FmMgZEKCtudI_',
            'value': 1.0,
            'currency': 'EUR'
        });
    </script>

</body>

</html>