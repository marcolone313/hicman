<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header}"></head>
<link rel="stylesheet" th:href="@{/css/admin.css}">
<body class="admin-body">

<div class="admin-wrapper">
    <!-- Sidebar -->
    <aside th:replace="~{admin/fragments/sidebar :: sidebar('dashboard')}"></aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Top Bar -->
        <nav th:replace="~{admin/fragments/topbar :: topbar}"></nav>

        <!-- Content -->
        <div class="admin-content">
            <div class="container-fluid">
                <!-- Page Header -->
                <div class="page-header mb-4">
                    <h1 class="h3 mb-0">Dashboard</h1>
                    <p class="text-muted">Panoramica generale del sito</p>
                </div>

                <!-- Stats Cards -->
                <div class="row g-4 mb-4">
                    <!-- Total Posts -->
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-icon bg-primary">
                                <i class="bi bi-file-text"></i>
                            </div>
                            <div class="stats-content">
                                <h3 th:text="${totalPosts}">0</h3>
                                <p class="text-muted mb-0">Totale Post</p>
                            </div>
                        </div>
                    </div>

                    <!-- Published Posts -->
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-icon bg-success">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            <div class="stats-content">
                                <h3 th:text="${publishedPosts}">0</h3>
                                <p class="text-muted mb-0">Post Pubblicati</p>
                            </div>
                        </div>
                    </div>

                    <!-- Draft Posts -->
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-icon bg-warning">
                                <i class="bi bi-pencil"></i>
                            </div>
                            <div class="stats-content">
                                <h3 th:text="${draftPosts}">0</h3>
                                <p class="text-muted mb-0">Bozze</p>
                            </div>
                        </div>
                    </div>

                    <!-- Testimonials -->
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-icon bg-info">
                                <i class="bi bi-chat-quote"></i>
                            </div>
                            <div class="stats-content">
                                <h3 th:text="${publishedTestimonials}">0</h3>
                                <p class="text-muted mb-0">Testimonial</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Content -->
                <div class="row g-4">
                    <!-- Recent Posts -->
                    <div class="col-lg-7">
                        <div class="admin-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-clock-history me-2"></i>
                                    Post Recenti
                                </h5>
                                <a th:href="@{/admin/blog}" class="btn btn-sm btn-outline-primary">
                                    Vedi tutti
                                </a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Titolo</th>
                                                <th>Stato</th>
                                                <th>Data</th>
                                                <th>Azioni</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="post : ${recentPosts}">
                                                <td>
                                                    <div class="post-title-cell">
                                                        <strong th:text="${post.title}">Titolo</strong>
                                                        <small class="text-muted d-block" th:if="${post.sourceName}">
                                                            <i class="bi bi-newspaper"></i>
                                                            <span th:text="${post.sourceName}">Fonte</span>
                                                        </small>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="badge" 
                                                          th:classappend="${post.published} ? 'bg-success' : 'bg-warning'"
                                                          th:text="${post.published} ? 'Pubblicato' : 'Bozza'">
                                                        Stato
                                                    </span>
                                                </td>
                                                <td>
                                                    <small th:text="${#temporals.format(post.createdAt, 'dd/MM/yyyy')}">Data</small>
                                                </td>
                                                <td>
                                                    <a th:href="@{/admin/blog/edit/{id}(id=${post.id})}" 
                                                       class="btn btn-sm btn-outline-secondary"
                                                       title="Modifica">
                                                        <i class="bi bi-pencil"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                            <tr th:if="${#lists.isEmpty(recentPosts)}">
                                                <td colspan="4" class="text-center text-muted py-4">
                                                    <i class="bi bi-inbox display-6 d-block mb-2"></i>
                                                    Nessun post disponibile
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Testimonials -->
                    <div class="col-lg-5">
                        <div class="admin-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-chat-left-quote me-2"></i>
                                    Testimonial Recenti
                                </h5>
                                <a th:href="@{/admin/testimonials}" class="btn btn-sm btn-outline-primary">
                                    Vedi tutti
                                </a>
                            </div>
                            <div class="card-body">
                                <div th:if="${#lists.isEmpty(recentTestimonials)}" class="text-center text-muted py-4">
                                    <i class="bi bi-chat-quote display-6 d-block mb-2"></i>
                                    Nessun testimonial disponibile
                                </div>
                                
                                <div th:unless="${#lists.isEmpty(recentTestimonials)}" class="testimonial-list">
                                    <div class="testimonial-item" th:each="testimonial : ${recentTestimonials}">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <div>
                                                <strong th:text="${testimonial.author}">Autore</strong>
                                                <span class="badge ms-2" 
                                                      th:classappend="${testimonial.published} ? 'bg-success' : 'bg-warning'"
                                                      th:text="${testimonial.published} ? 'Pubblicato' : 'Bozza'">
                                                </span>
                                            </div>
                                            <a th:href="@{/admin/testimonials/edit/{id}(id=${testimonial.id})}" 
                                               class="btn btn-sm btn-outline-secondary">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                        </div>
                                        <p class="text-muted small mb-1" th:if="${testimonial.companyName}">
                                            <i class="bi bi-building"></i>
                                            <span th:text="${testimonial.companyName}">Azienda</span>
                                        </p>
                                        <p class="mb-0 small" th:text="${testimonial.getShortContent(80)}">
                                            Contenuto breve...
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="row g-4 mt-2">
                    <div class="col-12">
                        <div class="admin-card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-lightning me-2"></i>
                                    Azioni Rapide
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <a th:href="@{/admin/blog/new}" class="quick-action-btn">
                                            <i class="bi bi-plus-circle"></i>
                                            <span>Nuovo Post</span>
                                        </a>
                                    </div>
                                    <div class="col-md-3">
                                        <a th:href="@{/admin/testimonials/new}" class="quick-action-btn">
                                            <i class="bi bi-plus-circle"></i>
                                            <span>Nuovo Testimonial</span>
                                        </a>
                                    </div>
                                    <div class="col-md-3">
                                        <a th:href="@{/blog}" target="_blank" class="quick-action-btn">
                                            <i class="bi bi-newspaper"></i>
                                            <span>Rassegna Stampa</span>
                                        </a>
                                    </div>
                                    <div class="col-md-3">
                                        <a th:href="@{/blog/testimonials}" target="_blank" class="quick-action-btn">
                                            <i class="bi bi-chat-quote"></i>
                                            <span>Dicono di Noi</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>